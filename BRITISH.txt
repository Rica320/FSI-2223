nc ctf-fsi.fe.up 4006 

faz-se cat do ficheito main.c assim obtem-se o codigo fonte do main

tb se descobre que a um excutavel nessa diretoria reader e my_script.sh

A partir do main.c vê se uma tentativa de reedirecionamento para /flags/flag.txt
Vamos tentar ir para lá ...

Permissão negada, era fácil demais :)

No my_script.sh nota-se que se mudarmos as variáveis de ambiente (do ficheiro /tmp/env é exportado as variáveis de ambiente) conseguimos por o printenv a executar aquilo que queremos.

https://stackoverflow.com/questions/11525164/what-is-wrong-with-access -- não era

ao ir para a pasta tmp vemos que tem um ficheiro chamado last_log
Parece que o ficheiro é chamado por algum processo com acesso ao ficheiro uma vez que é possível a partir desse 
aceder às flags. Como é possivel confirmar no ficheiro last_log ("flag exists")

Dps de alguma pesquisa vimos que o cron, um agendador de tarefas , está a executar o reader e a enviar a informação para o tal last_log.

Assim descobre-se a vulnerablidade.

EXPLOIT:

Conseguimos executar código nosso.
Para tal criamos um ficheiro /tmp/env no qual o ficheiro my_script irá exportar as variaveis de ambiente.

ao adicionar /tmp ao inicio da PATH conseguimos executar código nosso que está na temp. Uma vez que será a primeira diretoria onde se procurará o ficheiro printenv
No nosso código chamamos system("cat /flags/flag.txt") (NOTA: Talvez conseguiamos chamar uma nova bash ao invés de executar o código escolhido)

Passado um pouco é possível ver a flag no last_log


 
